<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>App PHP-FPM</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="/assets/js/jquery.min.js"></script>
</head>

<body id="body">
  
  
  
  <a href="https://github.com/zabbix/community-templates/tree/main/Applications/Web-servers/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent)">
    <section class="banner-integrations">
	<div class="w container conference-header" id="training_overview" style="padding-top: 60px; min-height: 150px;">
		<div class="banner-content" style="padding-left: 0; padding-bottom: 16px;">
			<h1 class="h1 center">App PHP-FPM</h1>
		</div>
		<!-- <div class="w container">
			<div class="content text">
				<div class="grid grid-space-category center">
					
					<div class="span">
						<a class="card center category-button" href="" style="color: #25282F">category:languages </a>
					</div>
					
					<div class="span">
						<a class="card center category-button" href="" style="color: #25282F">category:api </a>
					</div>
					
					<div class="span">
						<a class="card center category-button" href="" style="color: #25282F">category:web </a>
					</div>
					
					<div class="span">
						<a class="card center category-button" href="" style="color: #25282F">title:PHP-FPM </a>
					</div>
					
				</div>
			</div>
		</div> -->
	</div>
</section>
  </a>
  <div class="w container">
    <h2 class="h2">Available versions</h2>
    <br>
    <div class="tabs-section">
      <div id="integrations_tabs" class="tabs">
        <ul>
          
          
          <li>
            <a class="js_tab" id="ver_5_0" href="#body">ver. 5.0
            </a>
          </li>
          
          <li>
            <a class="js_tab" id="ver_6_0" href="#body">ver. 6.0
            </a>
          </li>
          
          <li>
            <a class="js_tab" id="ver_5_4" href="#body">ver. 5.4
            </a>
          </li>
          
        </ul>
      </div>
    </div>
    <br>
    <br>
    
    
    <div id="content_ver_5_0" class="readme">
      <div class="banner-buttons " style="padding-top: 20px; ">
        <a class="button button-gray" style="color: #ffff;" href="/#applications-web-servers-template-zabbix-4-0-php-fpm-pools-lld-http-agent">Back to index</a>
        <a class="button button-green" style="color: #ffff;" href="https://raw.githubusercontent.com/zabbix/community-templates/main/Applications/Web-servers/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent)/5.0/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent).xml">Download</a>
      </div>
      
      



<h1 id="app-php-fpm">App PHP-FPM</h1>

<h2 id="overview">Overview</h2>

<p>(Check the latest version and updates to this doc at the repo: <a href="https://github.com/vigrai/zabbix-template-php-fpm">https://github.com/vigrai/zabbix-template-php-fpm</a> )</p>

<h1 id="zabbix-40-template-for-php-fpm-pools">Zabbix 4.0 Template for PHP-FPM Pools</h1>

<p>This is a template for monitoring php-fpm and it’s pools with <a href="www.zabbix.com">Zabbix</a>.</p>

<p>What’s special about this template, is that it <em>automatically</em> detects (using LLD) the running php-fpm pools and creates items for measuring metrics from each pool. It uses Http Agent type check in zabbix in order to parse the php status information into useful metrics.</p>

<p>So, if you are running a server with multiple php-fpm pools, this may be a better alternative for monitoring php than other templates available.</p>

<h1 id="compatibility">Compatibility</h1>

<p>This template was tested using:</p>

<table>
  <tbody>
    <tr>
      <td>Software</td>
      <td>Vesion</td>
    </tr>
  </tbody>
</table>

<p>| —— | —— |</p>

<table>
  <tbody>
    <tr>
      <td>Zabbix Server</td>
      <td>4.0.3</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Debian</td>
      <td>Stretch (9.8)</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Php-fpm</td>
      <td>7.2</td>
    </tr>
  </tbody>
</table>

<p>It might also work with other combination of versions.</p>

<h1 id="metrics">Metrics</h1>

<p>This are the metrics created for each php-fpm pool:</p>

<table>
  <tbody>
    <tr>
      <td>![N</td>
      <td>Solid](https://github.com/vigrai/zabbix-template-php-fpm/blob/master/img/metrics.png)</td>
    </tr>
  </tbody>
</table>

<h1 id="requirements">Requirements</h1>

<ul>
  <li>
    <p>Php-status should be enabled in the php-fpm pools.</p>
  </li>
  <li>
    <p>Php-status should be accessible and located in /php-status_POOLNAME for each pool (see step 4 of Setup).</p>
  </li>
</ul>

<h1 id="setup">Setup</h1>

<p>Even though this template is made with automation in mind, there’s still some manual steps to be done in the client (where php-fpm and zabbix-agent are running) in order to get it working:</p>

<ol>
  <li>Clone this template into a temporary directory.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # git clone https://github.com/vigrai/zabbix-template-php-fpm.git /tmp/zabbix-template


</code></pre></div></div>

<ol>
  <li>Put the file <code class="language-plaintext highlighter-rouge">php-fpm.discover\_pools.pl</code> into the /etc/zabbix directory and make it executable.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/php-fpm.discover\_pools.pl /etc/zabbix


 # chmod +x /etc/zabbix/php-fpm.discover\_pools.pl


 # chown zabbix.zabbix /etc/zabbix/php-fpm.discover\_pools.pl


</code></pre></div></div>

<ol>
  <li>Copy the file userparameter_php-fpm.conf into /etc/zabbix/zabbix_agentd.d.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/userparameter\_php-fpm.conf /etc/zabbix/zabbix\_agentd.d


</code></pre></div></div>

<ol>
  <li>Make sure that your php-fpm is correctly setup:</li>
</ol>

<p>[x] The pools should have php-status enabled.</p>

<p>[x] Php-status should be available in the path /fpm-status_[NAME-OF-THE-POOL]</p>

<p>Example configuration file for pool called <em>nms</em> (/etc/php/7.2/fpm/pool.d/nms.conf):</p>

<p><code class="language-plaintext highlighter-rouge">[nms]</code></p>

<p>`</p>

<h2 id="author">Author</h2>

<p>Fabio Gallese</p>

<h2 id="macros-used">Macros used</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Default</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>{$HOST.PHPFPM}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">127.0.0.1:8080</code></td>
      <td>Text macro</td>
    </tr>
    <tr>
      <td>{$PROTO}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">http</code></td>
      <td>Text macro</td>
    </tr>
  </tbody>
</table>

<h2 id="template-links">Template links</h2>

<p>There are no template links in this template.</p>

<h2 id="discovery-rules">Discovery rules</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PHP-FPM Pools Discovery</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>php-fpm.discover_pools&lt;p&gt;Update: 120s&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="items-collected">Items collected</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Memory Used by Pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.mem[“php-fpm: pool {#POOLNAME}”,,,,pmem]&lt;p&gt;Update: 120s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM Pool {#POOLNAME} status page</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">HTTP agent</code></td>
      <td>php-fpm.status[{#POOLNAME}]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>Process for pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.num[“php-fpm: pool {#POOLNAME}”]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Accepted Connections Per Second</td>
      <td>&lt;p&gt;The number of incoming requests per second that the pool has accepted; when a connection is accepted it is removed from the listen queue (displayed in real time).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.accepted_conn[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Active Processes</td>
      <td>&lt;p&gt;The number of servers current processing a page - the minimum is 1 (so even on a fully idle server, the result will be not read 0).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue</td>
      <td>&lt;p&gt;The current number of connections that have been initiated, but not yet accepted. If this value is non-zero it typically means that all the available server processes are currently busy, and there are no processes available to serve the next request. Raising pm.max_children (provided the server can handle it) should help keep this number low. This property follows from the fact that PHP-FPM listens via a socket (TCP or file based), and thus inherits some of the characteristics of sockets.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue Len</td>
      <td>&lt;p&gt;The upper limit on the number of connections that will be queued. Once this limit is reached, subsequent connections will either be refused, or ignored. This value is set by the php-fpm per pool configuration option ‘listen.backlog’, which defaults to -1 (unlimited). However, this value is also limited by the system (sysctl) value ‘net.core.somaxconn’, which defaults to 128 on many Linux systems.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue_len[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Active Processes</td>
      <td>&lt;p&gt;The highest value that ‘active processes’ has reached since the php-fpm server started. This value should not exceed pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Children Reached</td>
      <td>&lt;p&gt;The number of times that pm.max_children has been reached since the php-fpm pool started (only applicable if the process manager is ondemand or dynamic).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_children_reached[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Listen Queue</td>
      <td>&lt;p&gt;The maximum number of requests in the queue of pending connections since this FPM pool has started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Pool Name</td>
      <td>&lt;p&gt;The name of this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.pool[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Process Manager</td>
      <td>&lt;p&gt;The method used by the process manager to control the number of child processes (possible values: ondemand, dynamic or static) for this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.process_manager[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Slow Requests</td>
      <td>&lt;p&gt;The number of requests that exceeded your request_slowlog_timeout value.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.slow_requests[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Since</td>
      <td>&lt;p&gt;How long has this pool been running.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_since[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Time</td>
      <td>&lt;p&gt;The time when this pool was started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_time[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Total Processes</td>
      <td>&lt;p&gt;The total number of server processes currently running; the sum of idle processes + active processes. If the process manager is static, this number will match pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.total_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="triggers">Triggers</h2>

<p>There are no triggers in this template.</p>


    </div>
    
    
    <div id="content_ver_6_0" class="readme">
      <div class="banner-buttons " style="padding-top: 20px; ">
        <a class="button button-gray" style="color: #ffff;" href="/#applications-web-servers-template-zabbix-4-0-php-fpm-pools-lld-http-agent">Back to index</a>
        <a class="button button-green" style="color: #ffff;" href="https://raw.githubusercontent.com/zabbix/community-templates/main/Applications/Web-servers/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent)/6.0/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent).yaml">Download</a>
      </div>
      
      



<h1 id="app-php-fpm">App PHP-FPM</h1>

<h2 id="overview">Overview</h2>

<p>(Check the latest version and updates to this doc at the repo: <a href="https://github.com/vigrai/zabbix-template-php-fpm">https://github.com/vigrai/zabbix-template-php-fpm</a> )</p>

<h1 id="zabbix-40-template-for-php-fpm-pools">Zabbix 4.0 Template for PHP-FPM Pools</h1>

<p>This is a template for monitoring php-fpm and it’s pools with <a href="www.zabbix.com">Zabbix</a>.</p>

<p>What’s special about this template, is that it <em>automatically</em> detects (using LLD) the running php-fpm pools and creates items for measuring metrics from each pool. It uses Http Agent type check in zabbix in order to parse the php status information into useful metrics.</p>

<p>So, if you are running a server with multiple php-fpm pools, this may be a better alternative for monitoring php than other templates available.</p>

<h1 id="compatibility">Compatibility</h1>

<p>This template was tested using:</p>

<table>
  <tbody>
    <tr>
      <td>Software</td>
      <td>Vesion</td>
    </tr>
  </tbody>
</table>

<p>| —— | —— |</p>

<table>
  <tbody>
    <tr>
      <td>Zabbix Server</td>
      <td>4.0.3</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Debian</td>
      <td>Stretch (9.8)</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Php-fpm</td>
      <td>7.2</td>
    </tr>
  </tbody>
</table>

<p>It might also work with other combination of versions.</p>

<h1 id="metrics">Metrics</h1>

<p>This are the metrics created for each php-fpm pool:</p>

<table>
  <tbody>
    <tr>
      <td>![N</td>
      <td>Solid](https://github.com/vigrai/zabbix-template-php-fpm/blob/master/img/metrics.png)</td>
    </tr>
  </tbody>
</table>

<h1 id="requirements">Requirements</h1>

<ul>
  <li>
    <p>Php-status should be enabled in the php-fpm pools.</p>
  </li>
  <li>
    <p>Php-status should be accessible and located in /php-status_POOLNAME for each pool (see step 4 of Setup).</p>
  </li>
</ul>

<h1 id="setup">Setup</h1>

<p>Even though this template is made with automation in mind, there’s still some manual steps to be done in the client (where php-fpm and zabbix-agent are running) in order to get it working:</p>

<ol>
  <li>Clone this template into a temporary directory.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # git clone https://github.com/vigrai/zabbix-template-php-fpm.git /tmp/zabbix-template


</code></pre></div></div>

<ol>
  <li>Put the file <code class="language-plaintext highlighter-rouge">php-fpm.discover\_pools.pl</code> into the /etc/zabbix directory and make it executable.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/php-fpm.discover\_pools.pl /etc/zabbix


 # chmod +x /etc/zabbix/php-fpm.discover\_pools.pl


 # chown zabbix.zabbix /etc/zabbix/php-fpm.discover\_pools.pl


</code></pre></div></div>

<ol>
  <li>Copy the file userparameter_php-fpm.conf into /etc/zabbix/zabbix_agentd.d.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/userparameter\_php-fpm.conf /etc/zabbix/zabbix\_agentd.d


</code></pre></div></div>

<ol>
  <li>Make sure that your php-fpm is correctly setup:</li>
</ol>

<p>[x] The pools should have php-status enabled.</p>

<p>[x] Php-status should be available in the path /fpm-status_[NAME-OF-THE-POOL]</p>

<p>Example configuration file for pool called <em>nms</em> (/etc/php/7.2/fpm/pool.d/nms.conf):</p>

<p><code class="language-plaintext highlighter-rouge">[nms]</code></p>

<p>`</p>

<h2 id="author">Author</h2>

<p>Fabio Gallese</p>

<h2 id="macros-used">Macros used</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Default</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>{$HOST.PHPFPM}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">127.0.0.1:8080</code></td>
      <td>Text macro</td>
    </tr>
    <tr>
      <td>{$PROTO}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">http</code></td>
      <td>Text macro</td>
    </tr>
  </tbody>
</table>

<h2 id="template-links">Template links</h2>

<p>There are no template links in this template.</p>

<h2 id="discovery-rules">Discovery rules</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PHP-FPM Pools Discovery</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>php-fpm.discover_pools&lt;p&gt;Update: 120s&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="items-collected">Items collected</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Memory Used by Pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.mem[“php-fpm: pool {#POOLNAME}”,,,,pmem]&lt;p&gt;Update: 120s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM Pool {#POOLNAME} status page</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">HTTP agent</code></td>
      <td>php-fpm.status[{#POOLNAME}]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>Process for pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.num[“php-fpm: pool {#POOLNAME}”]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Accepted Connections Per Second</td>
      <td>&lt;p&gt;The number of incoming requests per second that the pool has accepted; when a connection is accepted it is removed from the listen queue (displayed in real time).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.accepted_conn[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Active Processes</td>
      <td>&lt;p&gt;The number of servers current processing a page - the minimum is 1 (so even on a fully idle server, the result will be not read 0).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue</td>
      <td>&lt;p&gt;The current number of connections that have been initiated, but not yet accepted. If this value is non-zero it typically means that all the available server processes are currently busy, and there are no processes available to serve the next request. Raising pm.max_children (provided the server can handle it) should help keep this number low. This property follows from the fact that PHP-FPM listens via a socket (TCP or file based), and thus inherits some of the characteristics of sockets.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue Len</td>
      <td>&lt;p&gt;The upper limit on the number of connections that will be queued. Once this limit is reached, subsequent connections will either be refused, or ignored. This value is set by the php-fpm per pool configuration option ‘listen.backlog’, which defaults to -1 (unlimited). However, this value is also limited by the system (sysctl) value ‘net.core.somaxconn’, which defaults to 128 on many Linux systems.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue_len[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Active Processes</td>
      <td>&lt;p&gt;The highest value that ‘active processes’ has reached since the php-fpm server started. This value should not exceed pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Children Reached</td>
      <td>&lt;p&gt;The number of times that pm.max_children has been reached since the php-fpm pool started (only applicable if the process manager is ondemand or dynamic).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_children_reached[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Listen Queue</td>
      <td>&lt;p&gt;The maximum number of requests in the queue of pending connections since this FPM pool has started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Pool Name</td>
      <td>&lt;p&gt;The name of this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.pool[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Process Manager</td>
      <td>&lt;p&gt;The method used by the process manager to control the number of child processes (possible values: ondemand, dynamic or static) for this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.process_manager[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Slow Requests</td>
      <td>&lt;p&gt;The number of requests that exceeded your request_slowlog_timeout value.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.slow_requests[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Since</td>
      <td>&lt;p&gt;How long has this pool been running.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_since[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Time</td>
      <td>&lt;p&gt;The time when this pool was started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_time[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Total Processes</td>
      <td>&lt;p&gt;The total number of server processes currently running; the sum of idle processes + active processes. If the process manager is static, this number will match pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.total_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="triggers">Triggers</h2>

<p>There are no triggers in this template.</p>


    </div>
    
    
    <div id="content_ver_5_4" class="readme">
      <div class="banner-buttons " style="padding-top: 20px; ">
        <a class="button button-gray" style="color: #ffff;" href="/#applications-web-servers-template-zabbix-4-0-php-fpm-pools-lld-http-agent">Back to index</a>
        <a class="button button-green" style="color: #ffff;" href="https://raw.githubusercontent.com/zabbix/community-templates/main/Applications/Web-servers/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent)/5.4/template_zabbix_4.0_php-fpm_pools_(lld_+_http_agent).yaml">Download</a>
      </div>
      
      



<h1 id="app-php-fpm">App PHP-FPM</h1>

<h2 id="overview">Overview</h2>

<p>(Check the latest version and updates to this doc at the repo: <a href="https://github.com/vigrai/zabbix-template-php-fpm">https://github.com/vigrai/zabbix-template-php-fpm</a> )</p>

<h1 id="zabbix-40-template-for-php-fpm-pools">Zabbix 4.0 Template for PHP-FPM Pools</h1>

<p>This is a template for monitoring php-fpm and it’s pools with <a href="www.zabbix.com">Zabbix</a>.</p>

<p>What’s special about this template, is that it <em>automatically</em> detects (using LLD) the running php-fpm pools and creates items for measuring metrics from each pool. It uses Http Agent type check in zabbix in order to parse the php status information into useful metrics.</p>

<p>So, if you are running a server with multiple php-fpm pools, this may be a better alternative for monitoring php than other templates available.</p>

<h1 id="compatibility">Compatibility</h1>

<p>This template was tested using:</p>

<table>
  <tbody>
    <tr>
      <td>Software</td>
      <td>Vesion</td>
    </tr>
  </tbody>
</table>

<p>| —— | —— |</p>

<table>
  <tbody>
    <tr>
      <td>Zabbix Server</td>
      <td>4.0.3</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Debian</td>
      <td>Stretch (9.8)</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Php-fpm</td>
      <td>7.2</td>
    </tr>
  </tbody>
</table>

<p>It might also work with other combination of versions.</p>

<h1 id="metrics">Metrics</h1>

<p>This are the metrics created for each php-fpm pool:</p>

<table>
  <tbody>
    <tr>
      <td>![N</td>
      <td>Solid](https://github.com/vigrai/zabbix-template-php-fpm/blob/master/img/metrics.png)</td>
    </tr>
  </tbody>
</table>

<h1 id="requirements">Requirements</h1>

<ul>
  <li>
    <p>Php-status should be enabled in the php-fpm pools.</p>
  </li>
  <li>
    <p>Php-status should be accessible and located in /php-status_POOLNAME for each pool (see step 4 of Setup).</p>
  </li>
</ul>

<h1 id="setup">Setup</h1>

<p>Even though this template is made with automation in mind, there’s still some manual steps to be done in the client (where php-fpm and zabbix-agent are running) in order to get it working:</p>

<ol>
  <li>Clone this template into a temporary directory.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # git clone https://github.com/vigrai/zabbix-template-php-fpm.git /tmp/zabbix-template


</code></pre></div></div>

<ol>
  <li>Put the file <code class="language-plaintext highlighter-rouge">php-fpm.discover\_pools.pl</code> into the /etc/zabbix directory and make it executable.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/php-fpm.discover\_pools.pl /etc/zabbix


 # chmod +x /etc/zabbix/php-fpm.discover\_pools.pl


 # chown zabbix.zabbix /etc/zabbix/php-fpm.discover\_pools.pl


</code></pre></div></div>

<ol>
  <li>Copy the file userparameter_php-fpm.conf into /etc/zabbix/zabbix_agentd.d.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

 # cp /tmp/zabbix-template/userparameter\_php-fpm.conf /etc/zabbix/zabbix\_agentd.d


</code></pre></div></div>

<ol>
  <li>Make sure that your php-fpm is correctly setup:</li>
</ol>

<p>[x] The pools should have php-status enabled.</p>

<p>[x] Php-status should be available in the path /fpm-status_[NAME-OF-THE-POOL]</p>

<p>Example configuration file for pool called <em>nms</em> (/etc/php/7.2/fpm/pool.d/nms.conf):</p>

<p><code class="language-plaintext highlighter-rouge">[nms]</code></p>

<p>`</p>

<h2 id="author">Author</h2>

<p>Fabio Gallese</p>

<h2 id="macros-used">Macros used</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Default</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>{$HOST.PHPFPM}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">127.0.0.1:8080</code></td>
      <td>Text macro</td>
    </tr>
    <tr>
      <td>{$PROTO}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">http</code></td>
      <td>Text macro</td>
    </tr>
  </tbody>
</table>

<h2 id="template-links">Template links</h2>

<p>There are no template links in this template.</p>

<h2 id="discovery-rules">Discovery rules</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PHP-FPM Pools Discovery</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>php-fpm.discover_pools&lt;p&gt;Update: 120s&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="items-collected">Items collected</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
      <th>Key and additional info</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Memory Used by Pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.mem[“php-fpm: pool {#POOLNAME}”,,,,pmem]&lt;p&gt;Update: 120s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM Pool {#POOLNAME} status page</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">HTTP agent</code></td>
      <td>php-fpm.status[{#POOLNAME}]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>Process for pool {#POOLNAME}</td>
      <td>&lt;p&gt;-&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Zabbix agent</code></td>
      <td>proc.num[“php-fpm: pool {#POOLNAME}”]&lt;p&gt;Update: 60s&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Accepted Connections Per Second</td>
      <td>&lt;p&gt;The number of incoming requests per second that the pool has accepted; when a connection is accepted it is removed from the listen queue (displayed in real time).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.accepted_conn[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Active Processes</td>
      <td>&lt;p&gt;The number of servers current processing a page - the minimum is 1 (so even on a fully idle server, the result will be not read 0).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue</td>
      <td>&lt;p&gt;The current number of connections that have been initiated, but not yet accepted. If this value is non-zero it typically means that all the available server processes are currently busy, and there are no processes available to serve the next request. Raising pm.max_children (provided the server can handle it) should help keep this number low. This property follows from the fact that PHP-FPM listens via a socket (TCP or file based), and thus inherits some of the characteristics of sockets.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Listen Queue Len</td>
      <td>&lt;p&gt;The upper limit on the number of connections that will be queued. Once this limit is reached, subsequent connections will either be refused, or ignored. This value is set by the php-fpm per pool configuration option ‘listen.backlog’, which defaults to -1 (unlimited). However, this value is also limited by the system (sysctl) value ‘net.core.somaxconn’, which defaults to 128 on many Linux systems.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.listen_queue_len[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Active Processes</td>
      <td>&lt;p&gt;The highest value that ‘active processes’ has reached since the php-fpm server started. This value should not exceed pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_active_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Children Reached</td>
      <td>&lt;p&gt;The number of times that pm.max_children has been reached since the php-fpm pool started (only applicable if the process manager is ondemand or dynamic).&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_children_reached[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Max Listen Queue</td>
      <td>&lt;p&gt;The maximum number of requests in the queue of pending connections since this FPM pool has started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.max_listen_queue[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Pool Name</td>
      <td>&lt;p&gt;The name of this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.pool[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Process Manager</td>
      <td>&lt;p&gt;The method used by the process manager to control the number of child processes (possible values: ondemand, dynamic or static) for this pool.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.process_manager[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Slow Requests</td>
      <td>&lt;p&gt;The number of requests that exceeded your request_slowlog_timeout value.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.slow_requests[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Since</td>
      <td>&lt;p&gt;How long has this pool been running.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_since[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Start Time</td>
      <td>&lt;p&gt;The time when this pool was started.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.start_time[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>PHP-FPM ({#POOLNAME}): Total Processes</td>
      <td>&lt;p&gt;The total number of server processes currently running; the sum of idle processes + active processes. If the process manager is static, this number will match pm.max_children.&lt;/p&gt;</td>
      <td><code class="language-plaintext highlighter-rouge">Dependent item</code></td>
      <td>php-fpm.total_processes[{#POOLNAME}]&lt;p&gt;Update: 0&lt;/p&gt;&lt;p&gt;LLD&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>

<h2 id="triggers">Triggers</h2>

<p>There are no triggers in this template.</p>


    </div>
    
  </div>
  <script>
    (function () {
      
      //console.log('#content_ver_5_4');
      //console.log('#ver_5_4');
      $('.readme').hide();
      $('#content_ver_5_4').fadeIn('slow');
      $('#ver_5_4').addClass('active');

      
      $('#ver_5_0').click(function () {
        //console.log('#content_ver_5_0');
        //console.log('#ver_5_0');
        $('.readme').hide();
        $('#content_ver_5_0').fadeIn('slow');
        $('.js_tab').removeClass('active')
        $('#ver_5_0').addClass('active');
      })
      
      $('#ver_6_0').click(function () {
        //console.log('#content_ver_6_0');
        //console.log('#ver_6_0');
        $('.readme').hide();
        $('#content_ver_6_0').fadeIn('slow');
        $('.js_tab').removeClass('active')
        $('#ver_6_0').addClass('active');
      })
      
      $('#ver_5_4').click(function () {
        //console.log('#content_ver_5_4');
        //console.log('#ver_5_4');
        $('.readme').hide();
        $('#content_ver_5_4').fadeIn('slow');
        $('.js_tab').removeClass('active')
        $('#ver_5_4').addClass('active');
      })
      
    })();
  </script>
</body>

</html>